---
- hosts: runner
  name: "prepare vagrant box"
  roles:
    - box_prepare

# HACK: workaround to install Python2 that is still required by Ansible
- hosts: image_box
  gather_facts: false
  become_user: root
  become: yes
  tasks:
    - name: install python and deps for ansible modules
      raw: test -e /usr/bin/python || dnf install -y python2 python2-dnf libselinux-python
    - name: gather facts
      setup:

- hosts: image_box
  name: "modify vagrant box template"
  roles:
    - role: machine_common
      prepare_image: true
    - role: machine_clean
      prepare_image: true

- hosts: runner
  name: "create image box"
  roles:
    - box_create
