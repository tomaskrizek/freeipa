---
- name: "set selinux mode"
  selinux:
    state: "{{ selinux_mode }}"
    policy: targeted

- name: "enable FreeIPA COPR repo"
  shell: "dnf copr enable -y {{ copr_repo }}"

- name: "disable updates-testing repository"
  shell: dnf config-manager --set-disabled updates-testing

- name: "update distro packages"
  dnf:
    name: "*"
    state: latest

# TODO remove
- name: "install haveged"
  dnf:
    name: haveged
    state: present

- name: "start&enable haveged for RNG noise"
  service:
    name: haveged
    enabled: yes
    state: started

- name: "set authorized keys for root"
  authorized_key:
    user: root
    state: present
    key: '{{ item }}'
  with_file:
    - keys/freeipa_pr_ci.pub
    - keys/freeipa_pr_ci_insecure.pub

- name: "set authorized keys for vagrant"
  authorized_key:
    user: vagrant
    state: present
    key: '{{ item }}'
  with_file:
    - keys/freeipa_pr_ci.pub
    - keys/freeipa_pr_ci_insecure.pub
    - keys/vagrant.pub

